(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{369:(e,t,s)=>{"use strict";s.d(t,{A:()=>l}),s(7876);var a=s(4232);s(698);let l=(0,a.createContext)()},698:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let a=s(1040).A.create({baseURL:"http://127.0.0.1:8000/api",timeout:5e3,headers:{"Content-Type":"application/json",accept:"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("authTokens")?JSON.parse(localStorage.getItem("authTokens")):null;return t&&(e.headers.Authorization=`Bearer ${t.access}`),e},e=>Promise.reject(e));let l=a},3799:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/MyPage",function(){return s(6428)}])},6428:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(7876),l=s(4232),r=s(1603),n=s(369),o=s(698);let c=()=>{let{user:e,setUser:t}=(0,l.useContext)(n.A),s=(0,r.Zp)(),c=(0,l.useCallback)(async()=>{try{let{data:e}=await o.A.get("/auth/user/");t(e),localStorage.setItem("user",JSON.stringify(e))}catch(e){console.error("ユーザー情報の取得に失敗",e)}},[t]);(0,l.useEffect)(()=>{c();let e=()=>c();return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[t]);let[i,d]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[h,p]=(0,l.useState)("");(0,l.useEffect)(()=>{e&&(d(e.username),m(e.email))},[e]);let x=async e=>{e.preventDefault(),p("");try{let e=await o.A.put("/auth/user/",{username:i,email:u});t(e.data),localStorage.setItem("user",JSON.stringify(e.data)),p("プロフィールを更新しました。")}catch(e){console.error(e),p("プロフィール更新に失敗しました。")}},b=async()=>{try{let e=await o.A.post("/create-portal-session/");window.location.href=e.data.url}catch(e){console.error(e),alert("お支払い情報の管理ページへの遷移に失敗しました。")}};if(!e)return(0,a.jsx)("div",{className:"text-center py-10",children:"読み込み中…"});let g="premium"===e.plan;return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-12 max-w-3xl",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-center mb-8",children:"マイページ"}),(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg space-y-8",children:[(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:"プロフィール編集"}),h&&(0,a.jsx)("p",{className:"text-green-700 bg-green-100 p-3 rounded-md",children:h}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block font-bold mb-1",children:"ユーザー名"}),(0,a.jsx)("input",{id:"username",type:"text",value:i,onChange:e=>d(e.target.value),className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block font-bold mb-1",children:"メールアドレス"}),(0,a.jsx)("input",{id:"email",type:"email",value:u,disabled:!0,className:"w-full p-2 border rounded bg-gray-100"})]}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",children:"更新"})]}),(0,a.jsx)("hr",{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:"ご契約プラン"}),(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-lg capitalize font-bold text-yellow-600",children:[e.plan,"プラン"]}),g?(0,a.jsx)("button",{onClick:b,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:"お支払い情報の管理・解約"}):(0,a.jsx)("button",{onClick:()=>s("/upgrade"),className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded",children:"プレミアム会員にアップグレード"})]}),g&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"※クレジットカード情報の変更や解約は上記ボタンから行えます。"})]})]})]})}},9609:(e,t)=>{"use strict";Object.prototype.toString}},e=>{var t=t=>e(e.s=t);e.O(0,[593,230,40,636,792],()=>t(3799)),_N_E=e.O()}]);