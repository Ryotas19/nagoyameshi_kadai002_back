(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{369:(e,t,s)=>{"use strict";s.d(t,{A:()=>l}),s(7876);var a=s(4232);s(698);let l=(0,a.createContext)()},698:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let a=s(1040).A.create({baseURL:"http://127.0.0.1:8000/api",timeout:5e3,headers:{"Content-Type":"application/json",accept:"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("authTokens")?JSON.parse(localStorage.getItem("authTokens")):null;return t&&(e.headers.Authorization=`Bearer ${t.access}`),e},e=>Promise.reject(e));let l=a},2070:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(7876),l=s(4232),r=s(1603),n=s(698),o=s(369);let c=e=>{let{rating:t,setRating:s}=e,l=!!s;return(0,a.jsx)("div",{className:"flex items-center",children:[1,2,3,4,5].map(e=>(0,a.jsx)("span",{className:`text-2xl ${l?"cursor-pointer":""} ${t>=e?"text-yellow-400":"text-gray-300"}`,onClick:()=>l&&s(e),children:"★"},e))})},d=e=>{let{featureName:t}=e,s=(0,r.Zp)();return(0,a.jsxs)("div",{className:"text-center bg-gray-100 p-6 rounded-lg mb-8",children:[(0,a.jsxs)("p",{className:"mb-4",children:[t," 機能はプレミアムプランが必要です。"]}),(0,a.jsx)("button",{onClick:()=>s("/upgrade"),className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg",children:"アップグレードする"})]})},i=()=>{let{id:e}=(0,r.g)(),{user:t}=(0,l.useContext)(o.A),s=(0,r.Zp)(),i=t&&"premium"===t.plan,[x,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[b,p]=(0,l.useState)(0),[g,j]=(0,l.useState)(""),[N,y]=(0,l.useState)(""),[f,v]=(0,l.useState)(null),[w,_]=(0,l.useState)(0),[k,S]=(0,l.useState)(""),[C,A]=(0,l.useState)(""),[E,F]=(0,l.useState)(""),[$,q]=(0,l.useState)(1),[D,O]=(0,l.useState)(""),T=(0,l.useCallback)(async()=>{try{let t=await n.A.get(`/restaurants/${e}/`);u(t.data)}catch(e){console.error("店舗詳細の取得に失敗しました",e)}},[e]);(0,l.useEffect)(()=>{T()},[T]);let L=async()=>{try{await n.A.post(`/restaurants/${e}/favorite/`),T()}catch(e){console.error("お気に入り登録に失敗しました",e)}},P=async a=>{if(a.preventDefault(),!t){alert("予約するにはログインが必要です。"),s("/login");return}O("");try{await n.A.post("/reservations/",{restaurant:Number(e),reservation_date:C,reservation_time:E,number_of_people:$}),alert("予約が完了しました。"),A(""),F(""),q(1)}catch(e){console.error("予約に失敗しました",e.response?.data),O("この日時の予約はできません。")}},R=async t=>{if(t.preventDefault(),0===b)return void y("評価（星）を選択してください。");y("");try{await n.A.post("/reviews/",{restaurant:Number(e),rating:b,comment:g}),T(),p(0),j(""),h(!1)}catch(e){console.error("レビューの投稿に失敗しました",e.response?.data),y(e.response?.data.non_field_errors?.[0]||e.response?.data.detail||"レビューの投稿に失敗しました。")}},I=async e=>{if(e.preventDefault(),0===w)return void y("評価（星）を選択してください。");y("");try{await n.A.patch(`/reviews/${f.id}/`,{rating:w,comment:k}),T(),v(null)}catch(e){console.error("レビューの編集に失敗しました",e.response?.data),y(e.response?.data.non_field_errors?.[0]||e.response?.data.detail||"レビューの編集に失敗しました。")}},z=async e=>{if(window.confirm("このレビューを削除しますか？"))try{await n.A.delete(`/reviews/${e}/`),T(),f?.id===e&&v(null)}catch(e){console.error("レビューの削除に失敗しました",e),alert("レビューの削除に失敗しました。")}};return x?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"md:flex md:space-x-6",children:[(0,a.jsxs)("div",{className:"md:w-2/3",children:[(0,a.jsx)("img",{src:x.image||"https://placehold.co/1200x800/F0AD4E/FFFFFF?text=NAGOYAMESHI",alt:x.name,className:"w-full h-auto rounded-lg shadow mb-4"}),(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:x.name}),t&&(0,a.jsx)("button",{onClick:L,className:`ml-4 p-2 rounded-full transition-colors duration-200 ${x.is_favorited?"bg-pink-100 text-pink-500":"bg-gray-200 text-gray-400"}`,children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"})})})]}),(0,a.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 text-sm font-semibold mr-2 px-3 py-1 rounded-full",children:x.category_name}),(0,a.jsxs)("div",{className:"mt-4 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-indigo-600 mb-2",children:"説明"}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:x.description}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-green-600 mb-2",children:"住所"}),(0,a.jsx)("p",{className:"text-gray-600",children:x.address})]})]}),(0,a.jsx)("div",{className:"md:w-1/3",children:i?(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow sticky top-24",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"このお店を予約する"}),(0,a.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-bold mb-1",children:"日付"}),(0,a.jsx)("input",{type:"date",value:C,onChange:e=>A(e.target.value),className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-bold mb-1",children:"時間"}),(0,a.jsx)("input",{type:"time",value:E,onChange:e=>F(e.target.value),className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-bold mb-1",children:"人数"}),(0,a.jsx)("select",{value:$,onChange:e=>q(e.target.value),className:"w-full p-2 border rounded bg-white",required:!0,children:[...Array(10).keys()].map(e=>(0,a.jsxs)("option",{value:e+1,children:[e+1,"名"]},e+1))})]}),D&&(0,a.jsx)("p",{className:"text-red-500 text-center",children:D}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg",children:"予約を確定する"})]})]}):t?(0,a.jsx)(d,{featureName:"店舗の予約"}):(0,a.jsx)("div",{className:"bg-gray-100 p-6 rounded-lg text-center",children:(0,a.jsxs)("p",{children:["予約するには、",(0,a.jsx)(r.N_,{to:"/login",className:"text-yellow-500 font-bold",children:"ログイン"}),"が必要です。"]})})})]}),(0,a.jsx)("hr",{className:"my-12"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold mb-6",children:"レビュー"}),i&&!f&&(0,a.jsx)("div",{className:"mb-6",children:m?(0,a.jsxs)("form",{onSubmit:R,className:"bg-white p-6 rounded-lg shadow mb-8 space-y-4",children:[(0,a.jsx)("label",{className:"block font-bold mb-2",children:"評価"}),(0,a.jsx)(c,{rating:b,setRating:p}),(0,a.jsx)("label",{className:"block font-bold mb-1",children:"コメント"}),(0,a.jsx)("textarea",{value:g,onChange:e=>j(e.target.value),className:"w-full p-3 border rounded h-32",required:!0}),N&&(0,a.jsx)("p",{className:"text-red-500",children:N}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{type:"submit",className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg",children:"投稿する"}),(0,a.jsx)("button",{type:"button",onClick:()=>{h(!1),p(0),j("")},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg",children:"キャンセル"})]})]}):(0,a.jsx)("button",{onClick:()=>h(!0),className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg",children:"レビューを投稿する"})}),(0,a.jsx)("div",{className:"space-y-6",children:x.reviews.map(e=>(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow",children:f?.id===e.id?(0,a.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"レビューを編集"}),(0,a.jsx)(c,{rating:w,setRating:_}),(0,a.jsx)("textarea",{value:k,onChange:e=>S(e.target.value),className:"w-full p-3 border rounded h-32",required:!0}),N&&(0,a.jsx)("p",{className:"text-red-500",children:N}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{type:"submit",className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded",children:"更新する"}),(0,a.jsx)("button",{type:"button",onClick:()=>z(e.id),className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded",children:"削除"}),(0,a.jsx)("button",{type:"button",onClick:()=>v(null),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",children:"キャンセル"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"font-bold",children:e.user_username}),t&&e.user_username===t.username&&(0,a.jsx)("button",{onClick:()=>{v(e),_(e.rating),S(e.comment)},className:"text-sm text-blue-500 hover:underline",children:"編集"})]}),(0,a.jsx)(c,{rating:e.rating}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:e.comment}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:new Date(e.created_at).toLocaleString()})]})},e.id))})]})]}):(0,a.jsx)("div",{className:"text-center py-10",children:"読み込み中…"})}},7975:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/RestaurantDetailPage",function(){return s(2070)}])},9609:(e,t)=>{"use strict";Object.prototype.toString}},e=>{var t=t=>e(e.s=t);e.O(0,[593,230,40,636,792],()=>t(7975)),_N_E=e.O()}]);